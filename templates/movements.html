{% extends "layout.html" %}

{% block title %}
    Inventory Movements
{% endblock %}

{% block h1 %}
    <h1>Inventory Movements</h1>
{% endblock %}

{% block main %}
<div class="container text-center mt-4">
    <!-- Search input -->
    <div class="input-group w-50 mx-auto mb-4">
        <input type="text" id="search-input" class="form-control" placeholder="Search by name or code">
    </div>

    <!-- Table header (static) -->
    <div class="row py-2 align-items-center justify-content-center border-bottom">
        <div class="col-1">Date</div>
        <div class="col-1">Type</div>
        <div class="col" style="width: 5%;">Document_id</div>
        <div class="col" style="width: 5%;">Draft_id</div>
        <div class="col-1">Product Id</div>
        <div class="col-2">Name</div>     
        <div class="col" style="width: 5%;">Units</div>
        <div class="col" style="width: 5%;">Price</div>
        <div class="col" style="width: 5%;">Total</div>
        <div class="col-1">Note</div>
        <div class="col-1">Status</div>
    </div>

    <!-- Table body (dynamic) -->
    <div id="inventory-table">
        {% for item in movements %}
            <div class="row py-2 border-bottom align-items-center justify-content-center">
                <div class="col-1 small">{{item.date}}</div>
                <div class="col-1 small">{{item.type}}</div>
                <div class="col small" style="width: 5%;">{{item.document_id}}</div>
                <div class="col small" style="width: 5%;">{{item.draft_id}}</div>
                <div class="col-1 small">{{item.product_id}}</div>
                <div class="col-2 small" >{{item.name}}</div>     
                <div class="col small" style="width: 5%;">{{item.units}}</div>
                <div class="col small" style="width: 5%;">{{item.price}}</div>
                <div class="col small" style="width: 5%;">{{item.toal}}</div>
                <div class="col-1 small">{{item.note}}</div>
                <div class="col-1 small">{{item.status}}</div>
            </div>
        {% endfor %}
    </div>
</div>

<!-- JavaScript for live search -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const input = document.getElementById("search-input");
        const table = document.getElementById("inventory-table");

        if (!input || !table) {
            console.error("Search input or inventory table not found.");
            return;
        }

        input.addEventListener("input", function() {
            console.log("Typing:", input.value);  // âœ… See this in DevTools

            fetch(`/search_inventory_movements?q=${encodeURIComponent(input.value)}`)
                .then(response => response.json())
                .then(data => {
                    let html = "";

                    data.forEach(item => {
                        html += `
                            <div class="row py-2 border-bottom align-items-center justify-content-center">
                                <div class="col-1 small">${item.date}</div>
                                <div class="col-1 small">${item.type}</div>
                                <div class="col small" style="width: 5%;">${item.document_id}</div>
                                <div class="col small" style="width: 5%;">${item.draft_id}</div>
                                <div class="col-1 small">${item.product_id}</div>
                                <div class="col-2 small" >${item.name}</div>     
                                <div class="col small" style="width: 5%;">${item.units}</div>
                                <div class="col small" style="width: 5%;">${item.price}</div>
                                <div class="col small" style="width: 5%;">${item.toal}</div>
                                <div class="col-1 small">${item.note}</div>
                                <div class="col-1 small">${item.status}</div>
                            </div>
                        `;
                    });

                    if (data.length === 0) {
                        html = `<div class="text-muted mt-3">No results found.</div>`;
                    }

                    table.innerHTML = html;
                })
                .catch(error => console.error("Fetch error:", error));
        });
    });
</script>

{% endblock %}